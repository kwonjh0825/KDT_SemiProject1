{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>detail</h1>
<h4><b>{{article.pk}}. {{article.title}}</b></h4>
<p>{{article.user}}</p>

{% if article.image %}
<img src="{{article.image.url}}" alt="">
{% endif %}

<p>{{article.created_at}}</p>
<p>{{article.updated_at}}</p>

{% if request.user == article.user %}
  <a href="{% url 'articles:update' article.pk %}" class="p-2"><button type="button" class="btn btn-primary">수정하기</button></a>
  <form action="{% url 'articles:delete' article.pk %}" METHOD="POST" class="p-2">
    {% csrf_token %}
    <button type="submit" value="DELETE" class="btn btn-danger">삭제하기</button>
  </form>
{% endif %}

<p>이 여행지에 대한 의견을 남겨주세요</p>
  <div class="d-flex text-center">
    {% for emotion in emotions %}
    <div class="m-3">
      {% if request.user.is_authenticated %}
      {{ emotion.queryset }}
        <form action="{% url 'articles:emotes' article.pk emotion.value article %}" method="POST">
          {% csrf_token %}
          {% if emotion.exsit %}
            <input type="image" src="{% static 'emotions/' %}{{ emotion.value }}.png" value="{{ emotion.label }} 취소" style="width: 32px; height: 32px;"> 취소하기
          {% else %}
            <input type="image" src="{% static 'emotions/' %}{{ emotion.value }}.png" value="{{ emotion.label }}" style="width: 32px; height: 32px;">
          {% endif %}
        </form>
      {% else %}
        <button value="{{ emotion.label }}" disabled>{{ emotion.label }}</button>
      {% endif %}
      {{ emotion.count }}
    </div>
    {% endfor %}
  </div>

<hr>

리뷰 목록
{% for review in reviews %}
  <div>
    <a href="{% url 'articles:review_detail' review.pk %}"><p>리뷰 제목 - {{ review.title }}</p></a>
    
    <p>리뷰 내용 - {{ review.content }}</p>

  </div>
{% endfor %}

<hr>

<h3>
  댓글 목록
</h3>

{% for comment in comments %}
  <div>
    <p>댓글 번호 -
      {{ comment.pk }}
    </p>
    <p>댓글 작성자 -
      {{ comment.user }}
    </p>
    <p>댓글 내용 -
      {{comment.content}}
    </p>
    {% if request.user == comment.user %}
      <form action="{% url 'articles:comment_delete' article.pk comment.pk %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="댓글 삭제">
      </form>
      <button onclick="dis()" id="comment_btn">댓글 수정</button>
      <div id="dis" style="display: none;">
        <form action="{% url 'articles:comment_update' article.pk comment.pk %}" method="POST">
          {% csrf_token %}
          {{ form.as_p }}
          <input type="submit" value="UPDATE">
        </form>
      </div>
    {% endif %}
  </div>
  <hr>
{% endfor %}

<form action="{% url 'articles:comment_create' article.pk %}" method="post">
  {% csrf_token %}
  {{ comment_form.as_p }}
  <input type="submit" value="댓글 작성">
</form>

<hr>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
  function dis(){
    if($('#dis').css('display') == 'none'){
      $('#dis').show();
      $('#comment_btn').text('댓글 수정 취소');
    }else{
      $('#dis').hide();
      $('#comment_btn').text('댓글 수정');
    }
  }
</script>
{% endblock content %}
