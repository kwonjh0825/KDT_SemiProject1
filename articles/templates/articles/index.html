{% extends 'base.html' %}

{% block content %}
<h1>index</h1>
<hr>
{% if request.user.is_authenticated %}
  <a href="{% url 'articles:create'%}">생성하기</a>
{% endif %}

<div id="map" style="width:1200px; height:800px;">

  {% comment %} {% for article in articles %}
  <div>
    <h4><a href="{% url 'articles:detail' article.pk %}">{{ article.title }}</a></h4>
    <p>작성자 - <a href="{% url 'accounts:profile' article.user %}">{{ article.user }}</a></p>
  </div>
  <hr>
  {% endfor %} {% endcomment %}
</div>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=44fdfd5aea6498bf2814ede3eae827b6&libraries=services,clusterer,drawing"></script>

<script>
  // 카카오맵
  var container = document.getElementById('map')
  var options = {
    center: new kakao.maps.LatLng(33.3846, 126.5535), // 제주도 중심지의 lat, lng값 
    level: 9,
    draggable: false, // 드래그 안되도록 사진 고정

  }
  var map = new kakao.maps.Map(container, options)
  {% comment %} var markerPosition = options.center
  var marker = new kakao.maps.Marker({
    position: markerPosition
  })
  marker.setMap(map) {% endcomment %}


  // 마커를 표시할 위치와 title 객체 배열입니다 


  var positions = [

  {% for article in articles %}
    { title : '<div class="container"><a href="{% url "articles:detail" article.pk %}" style="color:blue" target="_blank"> {{article.title}} </a> <br> {{article.category}}',
    latlng: new kakao.maps.LatLng({{article.lat}}, {{article.lng}})
    },
  {% endfor %},
    

];


// 마커 이미지의 이미지 주소입니다
var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; 

for (var i = 0; i < positions.length; i ++) {

// 마커 이미지의 이미지 크기 입니다
var imageSize = new kakao.maps.Size(24, 35); 

// 마커 이미지를 생성합니다    
var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 

// 마커를 생성합니다
var marker = new kakao.maps.Marker({
    map: map, // 마커를 표시할 지도
    position: positions[i].latlng, // 마커를 표시할 위치
    image : markerImage // 마커 이미지 


});

// 인포윈도우를 생성합니다
var infowindow = new kakao.maps.InfoWindow({
  position : positions[i].latlng, 
  content : positions[i].title, // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
});

// 마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됩니다
infowindow.open(map, marker); 


}

{% comment %} {% for article in articles %}
  var iwContent = '<div style="padding:5px;"> <a href="{% url "articles:detail" article.pk %}" style="color:blue" target="_blank"> {{article.title}} </a> <br> {{article.category}} </div>', // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
    iwPosition = new kakao.maps.LatLng({{article.lat}}, {{article.lng}}); //인포윈도우 표시 위치입니다

  // 인포윈도우를 생성합니다
  var infowindow = new kakao.maps.InfoWindow({
      position : iwPosition, 
      content : iwContent 
  });

  // 마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됩니다
  infowindow.open(map, marker); 
{% endfor %} {% endcomment %}
</script>
{% endblock content %}
